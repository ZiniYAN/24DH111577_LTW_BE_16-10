@model _24DH111577_LTW_BE_16_10.Models.ViewModel.ProductDetailVM

@{
    ViewBag.Title = "ProductDetails";
    Layout = "~/Areas/Customer/Views/Shared/_CustomerLayout.cshtml";
    <link rel="stylesheet" type="text/css" href="~/Content/CustomerDetailProduct.css" />
}

<div class="product-details">
    <div class="product-details__container">
        <!-- Image Section -->
        <div class="product-details__image">
            <img src="@Model.product.ProductImage" alt="@Model.product.ProductName" />
        </div>

        <!-- Info Section -->
        <div class="product-details__info">
            <h1 class="product-details__title">@Model.product.ProductName</h1>

            <div class="product-details__meta">
                <span class="product-details__sold">Đã bán: @Model.product.OrderDetails.Count</span>
            </div>

            <div class="product-details__price">
                @Model.product.ProductPrice.ToString("C", new System.Globalization.CultureInfo("vi-VN"))
            </div>

            <div style="margin: 20px 0;">
                <span class="product-details__category">
                    @Model.product.Category.CategoryName
                </span>
            </div>

            <h2 class="product-details__description-title">Mô tả sản phẩm</h2>
            <p class="product-details__description">
                @Model.product.ProductDescription
            </p>
        </div>

        <!-- Order Section -->
        <div class="product-details__order">
            @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post))
            {
                @Html.Hidden("id", Model.product.ProductID)

                <div class="product-details__quantity-group">
                    <label class="product-details__order-title">Số lượng</label>

                    <!-- Quantity Selector với nút +/- -->
                    <div class="quantity-selector">
                        <button type="button" class="quantity-btn quantity-btn--minus" onclick="decreaseQuantity()">
                            <i class="fa-solid fa-minus"></i>
                        </button>

                        <input type="number"
                               id="quantityInput"
                               name="quantity"
                               value="@Model.quantity"
                               min="1"
                               max="999"
                               class="quantity-input"
                               readonly />

                        <button type="button" class="quantity-btn quantity-btn--plus" onclick="increaseQuantity()">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>

                <div class="product-details__estimate">
                    <div class="product-details__estimate-label">Tạm tính</div>
                    <div class="product-details__estimate-value">
                        <span id="estimateDisplay">@Model.estimatedValue.ToString("N0")</span> ₫
                    </div>
                </div>

                <button type="submit" class="product-details__add-to-cart">
                    <i class="fa-solid fa-cart-plus"></i> Thêm vào giỏ hàng
                </button>
            }
        </div>
    </div>

    <!-- Related Products -->
    <div class="product-details__related">
        @Html.Partial("PVRelatedProduct", Model)
    </div>

    <!-- Top Products -->
    <div class="product-details__related">
        @Html.Partial("PVTopProduct", Model)
    </div>
</div>

<script>
    const unitPrice = @Model.product.ProductPrice;
    const quantityInput = document.getElementById('quantityInput');

    // Khởi tạo giá trị đúng khi load trang
    window.addEventListener('DOMContentLoaded', function() {
        // Đảm bảo input có giá trị từ server
        let initialValue = parseInt(quantityInput.value) || 1;
        if (initialValue < 1) {
            initialValue = 1;
        }
        quantityInput.value = initialValue;
        updateEstimate();
    });

    function increaseQuantity() {
        let currentValue = parseInt(quantityInput.value) || 1;
        if (currentValue < 999) {
            quantityInput.value = currentValue + 1;
            updateEstimate();
        }
    }

    function decreaseQuantity() {
        let currentValue = parseInt(quantityInput.value) || 1;
        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
            updateEstimate();
        }
    }

    function updateEstimate() {
        let quantity = parseInt(quantityInput.value) || 1;

        // Đảm bảo quantity tối thiểu là 1
        if (quantity < 1) {
            quantity = 1;
            quantityInput.value = 1;
        }

        let estimate = quantity * unitPrice;
        document.getElementById('estimateDisplay').innerText = estimate.toLocaleString('vi-VN');
    }
</script>

